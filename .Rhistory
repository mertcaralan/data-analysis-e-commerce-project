# ----------------------------
# 3) Helper function: build e-commerce in last 12 months
# ----------------------------
make_ecom_12m <- function(df) {
df <- df %>% mutate(year = as.integer(TIME_PERIOD))
has_direct <- any(
df$indic_is == "Last online purchase: in the 12 months" &
df$unit == "Percentage of individuals",
na.rm = TRUE
)
if (has_direct) {
df %>%
filter(
indic_is == "Last online purchase: in the 12 months",
unit == "Percentage of individuals",
year >= 2013, year <= 2024
) %>%
group_by(geo, year) %>%
summarise(ecom_12m = mean(OBS_VALUE, na.rm = TRUE), .groups = "drop")
} else {
df %>%
filter(
indic_is %in% c(
"Last online purchase: in the last 3 months",
"Last online purchase: between 3 and 12 months ago"
),
unit == "Percentage of individuals",
year >= 2013, year <= 2024
) %>%
group_by(geo, year) %>%
summarise(ecom_12m = sum(OBS_VALUE, na.rm = TRUE), .groups = "drop")
}
}
# ----------------------------
# 4) Build main e-commerce dataset (EU only)
# ----------------------------
ecom_before <- make_ecom_12m(before_raw)
ecom_after  <- make_ecom_12m(after_raw)
ecom_all <- bind_rows(ecom_before, ecom_after) %>%
arrange(geo, year) %>%
distinct(geo, year, .keep_all = TRUE) %>%
filter(geo %in% eu_countries)
# ----------------------------
# 0) Libraries
# ----------------------------
library(tidyverse)
library(stringr)
library(viridis)
library(psych)
# ----------------------------
# 1) Settings / Country list
# ----------------------------
eu_countries <- c(
"Austria", "Belgium", "Bulgaria", "Croatia", "Cyprus", "Czechia",
"Denmark", "Estonia", "Finland", "Germany", "Greece",
"Hungary", "Ireland", "Italy", "Latvia", "Lithuania", "Luxembourg",
"Malta", "Netherlands", "Poland", "Portugal", "Romania",
"Slovakia", "Slovenia", "Spain", "Sweden"
)
if (!dir.exists("plots")) {
dir.create("plots")
}
# ----------------------------
# 2) Load datasets
# ----------------------------
before_raw <- read_csv("internet_purchases_by_individuals_before_2020.csv")
# ----------------------------
# 2) Load datasets
# ----------------------------
before_raw <- read_csv("data/internet_purchases_by_individuals_before_2020.csv")
# ----------------------------
# 0) Libraries
# ----------------------------
library(tidyverse)
library(stringr)
library(viridis)
library(psych)
# ----------------------------
# 1) Settings / Country list
# ----------------------------
eu_countries <- c(
"Austria", "Belgium", "Bulgaria", "Croatia", "Cyprus", "Czechia",
"Denmark", "Estonia", "Finland", "Germany", "Greece",
"Hungary", "Ireland", "Italy", "Latvia", "Lithuania", "Luxembourg",
"Malta", "Netherlands", "Poland", "Portugal", "Romania",
"Slovakia", "Slovenia", "Spain", "Sweden"
)
if (!dir.exists("plots")) {
dir.create("plots")
}
# ----------------------------
# 2) Load datasets
# ----------------------------
before_raw <- read_csv("data/internet_purchases_by_individuals_before_2020.csv")
after_raw  <- read_csv("data/internet_purchases_by_individuals_after_2020.csv")
netacc_raw <- read_csv("data/level_of_internet_access.csv")
gdp_raw    <- read_csv("data/real_gdp_per_capita.csv")
broad_raw  <- read_csv("data/broadband_internet_coverage_by_speed.csv")
skills_raw <- read_csv("data/individuals_level_of_digital_skills.csv")
# ----------------------------
# 3) Helper function: build e-commerce in last 12 months
# ----------------------------
make_ecom_12m <- function(df) {
df <- df %>% mutate(year = as.integer(TIME_PERIOD))
has_direct <- any(
df$indic_is == "Last online purchase: in the 12 months" &
df$unit == "Percentage of individuals",
na.rm = TRUE
)
if (has_direct) {
df %>%
filter(
indic_is == "Last online purchase: in the 12 months",
unit == "Percentage of individuals",
year >= 2013, year <= 2024
) %>%
group_by(geo, year) %>%
summarise(ecom_12m = mean(OBS_VALUE, na.rm = TRUE), .groups = "drop")
} else {
df %>%
filter(
indic_is %in% c(
"Last online purchase: in the last 3 months",
"Last online purchase: between 3 and 12 months ago"
),
unit == "Percentage of individuals",
year >= 2013, year <= 2024
) %>%
group_by(geo, year) %>%
summarise(ecom_12m = sum(OBS_VALUE, na.rm = TRUE), .groups = "drop")
}
}
# ----------------------------
# 4) Build main e-commerce dataset (EU only)
# ----------------------------
ecom_before <- make_ecom_12m(before_raw)
ecom_after  <- make_ecom_12m(after_raw)
ecom_all <- bind_rows(ecom_before, ecom_after) %>%
arrange(geo, year) %>%
distinct(geo, year, .keep_all = TRUE) %>%
filter(geo %in% eu_countries)
# ----------------------------
# 5) Prepare other indicators (EU only)
# ----------------------------
netacc <- netacc_raw %>%
mutate(year = as.integer(TIME_PERIOD)) %>%
filter(year >= 2013, year <= 2024, geo %in% eu_countries) %>%
select(geo, year, netacc_value = OBS_VALUE)
gdp <- gdp_raw %>%
mutate(year = as.integer(TIME_PERIOD)) %>%
filter(year >= 2013, year <= 2024, geo %in% eu_countries) %>%
select(geo, year, gdp_value = OBS_VALUE)
broad <- broad_raw %>%
mutate(year = as.integer(TIME_PERIOD)) %>%
filter(year >= 2013, year <= 2024, geo %in% eu_countries) %>%
select(geo, year, broad_value = OBS_VALUE)
skills <- skills_raw %>%
mutate(year = as.integer(TIME_PERIOD)) %>%
filter(year >= 2013, year <= 2019, geo %in% eu_countries) %>%
select(geo, year, skills_value = OBS_VALUE)
# ----------------------------
# 6) Merge datasets
# ----------------------------
merged <- ecom_all %>%
left_join(netacc, by = c("geo", "year")) %>%
left_join(gdp,    by = c("geo", "year")) %>%
left_join(broad,  by = c("geo", "year")) %>%
left_join(skills, by = c("geo", "year")) %>%
mutate(
ecom_12m     = as.numeric(ecom_12m),
netacc_value = as.numeric(netacc_value),
gdp_value    = as.numeric(gdp_value),
broad_value  = as.numeric(broad_value),
skills_value = as.numeric(skills_value)
)
# ----------------------------
# 7.1 Heatmap: country ordering by average e-commerce adoption
# ----------------------------
country_order <- ecom_all %>%
group_by(geo) %>%
summarise(avg_ecom = mean(ecom_12m, na.rm = TRUE), .groups = "drop") %>%
arrange(desc(avg_ecom)) %>%
pull(geo)
p_heatmap <- ggplot(ecom_all,
aes(
x = factor(year),
y = factor(geo, levels = country_order),
fill = ecom_12m
)) +
geom_tile(color = "white", linewidth = 0.2) +
scale_fill_viridis(option = "C", name = "Percent") +
theme_minimal() +
theme(legend.position = "bottom") +
labs(
x = "Year",
y = "Country"
)
ggsave("plots/fig1_heatmap.png", p_heatmap, width = 10, height = 6, dpi = 300)
# ----------------------------
# 7.2 Boxplot: yearly distribution across countries (same logic, improved)
# ----------------------------
ecom_all_box <- ecom_all %>%
mutate(
year = as.integer(year),
year_f = factor(year, levels = sort(unique(year))),
ecom_12m = as.numeric(ecom_12m)
)
year_median <- ecom_all_box %>%
group_by(year_f) %>%
summarise(med = median(ecom_12m, na.rm = TRUE), .groups = "drop")
p_boxplot <- ggplot(ecom_all_box, aes(x = year_f, y = ecom_12m)) +
geom_boxplot(
width = 0.6,
outlier.alpha = 0.15,
outlier.size = 1,
linewidth = 0.6
) +
geom_point(
data = year_median,
aes(x = year_f, y = med),
inherit.aes = FALSE,
size = 2.2
) +
theme_minimal(base_size = 12) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.grid.minor = element_blank()
) +
labs(
x = "Year",
y = "Online shopping in last 12 months (%)"
)
ggsave("plots/fig2_boxplot.png", p_boxplot, width = 10, height = 6, dpi = 300)
# ----------------------------
# 8.1 Internet access vs e-commerce (country-year averages)
# ----------------------------
rel_netacc <- merged %>%
drop_na(netacc_value, ecom_12m) %>%
group_by(geo, year) %>%
summarise(
netacc = mean(netacc_value, na.rm = TRUE),
ecom   = mean(ecom_12m, na.rm = TRUE),
.groups = "drop"
)
p_netacc <- ggplot(rel_netacc, aes(x = netacc, y = ecom)) +
geom_point(alpha = 0.55, size = 2) +
geom_smooth(method = "lm", se = TRUE, linewidth = 1) +
theme_minimal(base_size = 12) +
labs(
x = "Internet access (%)",
y = "Online shopping in last 12 months (%)"
)
ggsave("plots/fig3_netacc_scatter.png", p_netacc, width = 8, height = 6, dpi = 300)
# ----------------------------
# 8.2 GDP per capita vs e-commerce (log scale for readability)
# ----------------------------
rel_gdp <- merged %>%
drop_na(gdp_value, ecom_12m) %>%
mutate(
gdp  = as.numeric(gdp_value),
ecom = as.numeric(ecom_12m)
) %>%
filter(gdp > 0)
p_gdp <- ggplot(rel_gdp, aes(x = gdp, y = ecom)) +
geom_point(alpha = 0.5, size = 2) +
geom_smooth(method = "lm", se = TRUE, linewidth = 1) +
scale_x_log10() +
theme_minimal(base_size = 12) +
labs(
x = "Real GDP per capita (PPS, log scale)",
y = "Online shopping in last 12 months (%)"
)
ggsave("plots/fig4_gdp_scatter.png", p_gdp, width = 8, height = 6, dpi = 300)
# ----------------------------
# 8.3 Digital skills vs e-commerce (2013–2019)
# ----------------------------
rel_skills <- merged %>%
drop_na(skills_value, ecom_12m) %>%
filter(year <= 2019) %>%
group_by(geo, year) %>%
summarise(
skills = mean(skills_value, na.rm = TRUE),
ecom   = mean(ecom_12m, na.rm = TRUE),
.groups = "drop"
)
p_skills <- ggplot(rel_skills, aes(x = skills, y = ecom)) +
geom_point(alpha = 0.7) +
geom_smooth(method = "lm", se = FALSE, linewidth = 1.2) +
theme_minimal() +
labs(
x = "Digital skills (%)",
y = "Online shopping in last 12 months (%)"
)
ggsave("plots/fig5_skills_scatter.png", p_skills, width = 8, height = 6, dpi = 300)
# ----------------------------
# 9.1 Correlation matrix (pairwise)
# ----------------------------
cor_table <- merged %>%
select(ecom_12m, netacc_value, gdp_value, broad_value, skills_value) %>%
cor(use = "pairwise.complete.obs")
cor_table
# ----------------------------
# 9.2 Descriptive statistics
# ----------------------------
numeric_vars <- merged %>%
select(ecom_12m, netacc_value, gdp_value, broad_value, skills_value)
descriptives <- psych::describe(numeric_vars)
descriptives
# ----------------------------
# 9.3 Export merged dataset
# ----------------------------
write_csv(merged, "merged_dataset.csv")
# ----------------------------
# 10.1 Back-to-back pyramid plot (mirrored counts)
# ----------------------------
ecom_pyramid <- ecom_all %>%
mutate(period = case_when(
year <= 2019 ~ "Pre-COVID (2013–2019)",
year >= 2020 ~ "Post-COVID (2020–2024)",
TRUE ~ NA_character_
)) %>%
drop_na(period, ecom_12m) %>%
mutate(
ecom_12m = as.numeric(ecom_12m),
bin = cut(
ecom_12m,
breaks = seq(0, 100, by = 5),
include.lowest = TRUE,
right = FALSE
)
) %>%
count(bin, period) %>%
mutate(count_mirror = if_else(period == "Pre-COVID (2013–2019)", -n, n))
p_pyramid <- ggplot(ecom_pyramid, aes(x = count_mirror, y = bin, fill = period)) +
geom_col(width = 0.9) +
scale_x_continuous(labels = function(x) abs(x)) +
theme_minimal() +
labs(
x = "Number of observations (mirrored)",
y = "Online shopping in last 12 months (%)",
fill = "Period"
)
ggsave("plots/fig6_pyramid.png", p_pyramid, width = 8, height = 6, dpi = 300)
# ----------------------------
# 10.2 Butterfly chart (2019 vs 2024 country comparison)
# ----------------------------
ecom_butterfly <- ecom_all %>%
filter(year %in% c(2019, 2024)) %>%
mutate(
ecom_12m = as.numeric(ecom_12m),
value = ifelse(year == 2019, -ecom_12m, ecom_12m),
year = factor(year)
)
p_butterfly <- ggplot(ecom_butterfly,
aes(x = reorder(geo, ecom_12m),
y = value,
fill = year)) +
geom_col(width = 0.8) +
coord_flip() +
scale_y_continuous(labels = abs) +
theme_minimal() +
theme(
legend.position = "bottom",
legend.direction = "horizontal"
) +
labs(
x = "Country",
y = "Percent",
fill = "Year"
)
ggsave("plots/fig7_butterfly.png", p_butterfly, width = 9, height = 7, dpi = 300)
library(ggplot2)
library(tibble)
ga_df <- tibble(
x = c(1, 2, 3),
y = c(1, 1, 1),
title = c("INPUTS (Eurostat)",
"PROCESS (R pipeline)",
"OUTPUTS (Phase 3)"),
text = c(
paste(
"• Online purchases (last 12 months)",
"• Internet access",
"• GDP per capita (PPS)",
"• Broadband coverage",
"• Digital skills",
sep = "\n"
),
paste(
"• Cleaning & harmonization (EU, 2013–2024)",
"• Construct ecom_12m indicator",
"• Country–year panel merge",
"• Descriptive & visual analysis",
"• COVID comparison",
sep = "\n"
),
paste(
"• Trends: heatmap & boxplots",
"• Relationships: access, GDP, skills",
"• COVID: pre vs post, 2019 vs 2024",
sep = "\n"
)
),
fill = c("#E3F2FD", "#E8F5E9", "#F3E5F5")  # pastel colors
)
p_ga_light <- ggplot(ga_df, aes(x, y)) +
# boxes
geom_label(
aes(label = paste0(title, "\n\n", text), fill = fill),
color = "black",
label.size = 0.4,
label.padding = unit(0.7, "lines"),
size = 4,
show.legend = FALSE
) +
scale_fill_identity() +
# arrows
annotate("segment",
x = 1.35, xend = 1.65, y = 1, yend = 1,
arrow = arrow(length = unit(0.15, "inches")),
linewidth = 0.6, color = "grey40") +
annotate("segment",
x = 2.35, xend = 2.65, y = 1, yend = 1,
arrow = arrow(length = unit(0.15, "inches")),
linewidth = 0.6, color = "grey40") +
# title
annotate("text",
x = 2, y = 1.45,
label = "Graphical Abstract: E-Commerce Adoption & Digital Divide in the EU (2013–2024)",
size = 5.2, fontface = "bold") +
# takeaway
annotate("text",
x = 2, y = 0.55,
label = "Key takeaway: Adoption increased after 2020, yet cross-country gaps persist.",
size = 4.2) +
theme_void() +
coord_cartesian(xlim = c(0.5, 3.5), ylim = c(0.3, 1.55))
ggsave(
"plots/graphical_abstract.png",
p_ga_light,
width = 14,
height = 6,
dpi = 300,
bg = "white"
)
numeric_vars <- merged %>%
select(ecom_12m, netacc_value, gdp_value, broad_value, skills_value)
# Основные descriptive statistics
desc <- psych::describe(numeric_vars)
# Квартилы
q1 <- apply(numeric_vars, 2, quantile, probs = 0.25, na.rm = TRUE)
q3 <- apply(numeric_vars, 2, quantile, probs = 0.75, na.rm = TRUE)
# Собираем таблицу EXACT как в PDF
descriptives_pdf <- desc %>%
mutate(
`1st Qu.` = q1,
`3rd Qu.` = q3
) %>%
select(
n,
mean,
sd,
median,
trimmed,
mad,
min,
max,
range,
`1st Qu.`,
`3rd Qu.`,
skew,
kurtosis,
se
)
descriptives_pdf
descriptives_pdf
numeric_vars <- merged %>%
select(ecom_12m, netacc_value, gdp_value, broad_value, skills_value)
# Основные descriptive statistics
desc <- psych::describe(numeric_vars)
# Квартилы
q1 <- apply(numeric_vars, 2, quantile, probs = 0.25, na.rm = TRUE)
q3 <- apply(numeric_vars, 2, quantile, probs = 0.75, na.rm = TRUE)
# Собираем таблицу EXACT как в PDF
descriptives_all <- desc %>%
mutate(
`1st Qu.` = q1,
`3rd Qu.` = q3
) %>%
select(
n,
mean,
sd,
median,
trimmed,
mad,
min,
max,
range,
`1st Qu.`,
`3rd Qu.`,
skew,
kurtosis,
se
)
descriptives_all
install.packages("openxlsx")
library(openxlsx)
write.xlsx(descriptives_all, "descriptive_statistics.xlsx", rowNames = TRUE)
descriptives_all_rounded <- descriptives_all %>%
mutate(across(where(is.numeric), ~ round(.x, 2)))
write.xlsx(descriptives_all_rounded, "descriptive_statistics.xlsx", rowNames = TRUE)
